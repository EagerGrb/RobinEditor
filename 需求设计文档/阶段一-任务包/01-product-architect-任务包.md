# 阶段一任务包：product-architect

使用方式：本任务包用于统筹阶段一 Canvas 2D 的整体产品架构与协作规则，可直接作为你的执行清单。

## 一、技术栈与架构共识

1. 确认阶段一前端技术栈
   - 目标：React + TypeScript + 主流 UI 库（优先 Ant Design 或 MUI）。
   - 输出：技术选型决策记录（优缺点对比，最终结论）。

2. 确认 Monorepo 战略
   - 目标：统一采用 Monorepo（推荐 pnpm + Nx 或 Turborepo）。
   - 输出：Monorepo 结构约定文档（apps 与 packages 分层原则）。

3. 确认全局消息总线方案
   - 目标：确定是否使用第三方库（如 RxJS）或自研 event-bus。
   - 输出：消息总线设计简要，包括：事件模型、命名规范、错误处理策略。

## 二、模块边界与协作协议

4. 定义三大模块边界
   - UI 层（frontend-architect）：React 组件树、布局、输入事件采集与转发。
   - 图形内核（graphics-engineer）：工具链、图元 MVC、交互逻辑、几何算法。
   - 渲染引擎（rendering-core-expert）：渲染接口与性能优化，不感知 UI 与业务。
   - 输出：模块边界说明文档，明确每个模块「不做什么」。

5. 定义消息总线上的通用消息格式
   - 内容：topic 命名规则、payload 结构、错误码/状态字段、版本号字段。
   - 输出：事件规范表（至少覆盖：UI、输入、图形内核、渲染相关的核心事件）。

6. 定义跨模块接口契约
   - `IGraphicsKernel`：对 UI 暴露的接口（设置工具、处理输入、查询选中状态、导入导出场景）。
   - `IRenderer2D`：对图形内核/渲染中介者暴露的接口（初始化、渲染、清理、调整尺寸）。
   - 输出：接口草案（方法名、参数、返回值，以伪代码/TypeScript 接口形式记录）。

## 三、阶段一目标与验收标准

7. 定义阶段一 Canvas 2D MVP
   - 能完成：墙体绘制、门窗拖放、尺寸标注、网格吸附、基本视图控制。
   - 用户视角：新用户 10 分钟内可完成首个户型草图。
   - 输出：MVP 功能清单（标注「必需/可选」）。

8. 定义性能与体验指标
   - 性能：在典型户型（约 200 墙体）下交互流畅，无明显卡顿。
   - 体验：绘制/选择/编辑误操作率低，吸附与高亮行为直观。
   - 输出：可量化指标表（FPS、响应时间、常见操作步骤数等）。

9. 定义各角色的阶段一「完成」条件
   - frontend-architect：UI 框架与消息转发机制稳定可用。
   - graphics-engineer：图形内核支持完整绘制与编辑闭环。
   - rendering-core-expert：渲染输出稳定清晰，支持增量重绘。
   - qa-automation-expert：关键路径已有测试用例与缺陷追踪机制。
   - 输出：阶段一验收清单文档，供最终评审使用。

## 四、里程碑与节奏

10. 细化阶段一里程碑
    - M1：架构与 Monorepo 基础完成。
    - M2：墙体绘制全链路打通（UI → 内核 → 渲染）。
    - M3：门窗、尺寸、网格吸附接入。
    - M4：性能与交互细节优化，准备对接 WebGL 阶段。
    - 输出：时间轴与依赖关系图（可简化为清单形式）。

11. 建立变更与决策记录方式
    - 为关键决策建立轻量级 Decision Log（变更背景、选项、结论、影响）。
    - 输出：约定记录格式与存放位置（例如 需求设计文档/decisions 目录）。

12. 与 QA 沟通缺陷判断原则
    - 指定哪些行为算「缺陷」、哪些算「暂不支持」或「可接受折衷」。
    - 输出：缺陷判断指南（供 qa-automation-expert 使用）。

