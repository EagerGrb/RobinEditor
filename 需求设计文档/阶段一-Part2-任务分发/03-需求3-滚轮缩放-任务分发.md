# 需求 3：滚轮缩放（缩放比同步显示）—— 任务分发

目标：支持用户通过滚轮进行缩放，缩放以鼠标位置为中心，视口缩放比在 UI 中实时显示，并与命中/吸附阈值联动。

## PA 系（product-architect）

### TASK-3-PA-01 缩放交互策略定义
- 职责：
  - 确定滚轮缩放触发方式：
    - 建议：Ctrl + 滚轮 或 仅滚轮（若不用于垂直滚动）。
  - 定义缩放中心：
    - 采用「以鼠标位置为中心缩放」方案。
  - 设定缩放范围与步长：
    - 如：10% ~ 800%，每次滚轮变动对应固定缩放因子或使用指数曲线。
- 输出：
  - 写入交互规范文档「视图操作」章节。

## FE 系（frontend-architect）

### TASK-3-FE-01 Wheel 事件采集与标准化
- 职责：
  - 在 Canvas 容器中监听 `wheel` 事件：
    - 提取 delta（向上/向下）、鼠标位置、修饰键状态（Ctrl/Shift 等）。
    - 按 PA 定义的策略确定是否作为缩放动作处理。
  - 封装并发布：
    - `INPUT.VIEWPORT_ZOOM`（包含：屏幕坐标、缩放方向、原始 delta、修饰键）。

### TASK-3-FE-02 缩放比 UI 显示
- 职责：
  - 在状态栏组件中订阅：
    - `VIEWPORT.ZOOM_CHANGED` 事件（由内核发布）。
  - 将 scale 显示为人类可读的百分比（例如：125%、50%）。
  - 对极小或极大值进行格式化（如：<10% 显示为「10% 以下」）。

## GE 系（graphics-engineer）

### TASK-3-GE-01 视口缩放计算
- 职责：
  - 订阅 `INPUT.VIEWPORT_ZOOM`：
    - 将当前 scale 与 delta 组合为新的 scale（遵守 PA 定义的范围与步长）。
    - 转换屏幕坐标到世界坐标作为 anchor point。
    - 更新视口 offset，使得 anchor point 在屏幕中的位置尽量保持不变。
  - 更新视口状态后：
    - 发布 `VIEWPORT.ZOOM_CHANGED`（携带新 scale）。
    - 触发一次重绘。

### TASK-3-GE-02 缩放联动命中/吸附阈值
- 职责：
  - 根据当前 scale 动态调整：
    - 点到线段命中阈值（缩小时适当放大阈值，避免难点）。
    - 吸附阈值（视图缩小时仍易于吸附到关键点）。
  - 确保在极大缩放下仍不会出现「一动就吸附错对象」的问题。

## RE 系（rendering-core-expert）

### TASK-3-RE-01 渲染与缩放的配合
- 职责：
  - 与 GE 协作确定：
    - 视口缩放是通过修改 DrawCommand 中的坐标，还是通过 Canvas transform 完成。
  - 确保在缩放下：
    - 线宽与字体大小在视觉上保持适当（可能需要非线性缩放策略，由 GE/PA 决定具体规则）。

## QA 系（qa-automation-expert）

### TASK-3-QA-01 缩放中心一致性测试
- 职责：
  - 单元测试：
    - 在给定视口状态和 anchor point 下，缩放后该点在屏幕坐标中的变化是否在可接受误差内保持不变。
  - E2E 测试：
    - 在 UI 中多次对同一位置进行缩放，观察该位置附近图形是否保持在光标附近。

### TASK-3-QA-02 缩放与命中/吸附联动测试
- 职责：
  - 在不同缩放等级下：
    - 测试点击同一墙体是否都能稳定选中（在合理范围内）。
    - 测试吸附行为是否仍然可控（不会频繁吸附到远处对象）。

