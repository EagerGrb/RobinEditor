# 需求 1：左键拖拽框选 —— 任务分发

目标：支持用户按住左键拖拽，在画布上绘制选择矩形，对矩形范围内的图元进行多选。

## PA 系（product-architect）

### TASK-1-PA-01 定义框选交互规范
- 职责：
  - 约定何时触发框选：
    - 默认：在空白区域按下左键并拖拽一定距离触发框选模式。
    - 在已有选中图元上按下左键时，优先进入拖动选中集，而非框选。
  - 约定选择规则：完全包含 / 只要相交即可（二选一并写入规范）。
  - 约定多选行为：
    - 是否支持 Shift 追加选择。
    - 是否支持某修饰键触发「差集」或「交集」选择。
- 输出：
  - 更新到交互规范文档（03-阶段一-交互调研与规范）。

## FE 系（frontend-architect）

### TASK-1-FE-01 框选矩形可视化层
- 职责：
  - 在 Canvas 之上实现一个 UI 叠加层，用于绘制半透明框选矩形（不进入图形内核）。
  - 从原生 mousedown/mousemove/mouseup 中识别「左键拖拽」行为并计算矩形范围（屏幕坐标）。
- 输入：
  - DOM 层的鼠标事件。
- 输出：
  - 在 UI 层显示/隐藏框选矩形。

### TASK-1-FE-02 框选相关事件封装
- 职责：
  - 在 event-bus 中定义并发布以下事件：
    - `INPUT.BOX_SELECTION_START`（起点坐标、屏幕坐标系）。
    - `INPUT.BOX_SELECTION_CHANGE`（当前矩形对角点坐标）。
    - `INPUT.BOX_SELECTION_END`（最终矩形范围）。
  - 仅在拖拽距离超过设定阈值后才认定为框选，避免单击抖动触发。
- 输出：
  - 可供 graphics-engineer 订阅的标准化框选事件流。

## GE 系（graphics-engineer）

### TASK-1-GE-01 框选区域坐标转换
- 职责：
  - 将屏幕坐标下的框选矩形转换为世界坐标下的选择区域：
    - 使用现有视口矩阵（平移/缩放）进行逆变换。
  - 处理任意拖拽方向（左上→右下、右下→左上等），保证得到规范化的 min/max 边界。
- 输入：
  - `INPUT.BOX_SELECTION_*` 事件（屏幕坐标）。
- 输出：
  - 世界坐标系下的选择矩形（供命中测试使用）。

### TASK-1-GE-02 框选命中测试与多选逻辑
- 职责：
  - 遍历场景中的可选图元（墙体、门窗、家具、标注等）：
    - 使用各自的 boundingBox 与选择矩形进行相交/包含测试。
  - 根据 PA 定义的规则决定是否判定为「被选中」。
  - 支持：
    - 新建选中集。
    - 若按住 Shift，则追加到已有选中集；可选支持取消模式（再次选中则从选中集移除）。
- 输入：
  - 世界坐标下的选择矩形。
- 输出：
  - 更新 Selection 状态并触发 `GRAPHICS.SELECTION_CHANGED` 通知。

### TASK-1-GE-03 与工具链集成
- 职责：
  - 在 SelectionTool 或单独的 BoxSelectionTool 中处理 `BOX_SELECTION_*` 事件：
    - 开始时记录起点。
    - 变更时更新预览数据（若内核也需要）。
    - 结束时执行 TASK-1-GE-02 的命中测试逻辑。
  - 确保与其它工具（如绘制工具）之间的事件优先级和互斥关系清晰。

## RE 系（rendering-core-expert）

### TASK-1-RE-01 框选辅助视觉支持（可选）
- 职责：
  - 若框选矩形交由渲染引擎绘制：
    - 定义专用 DrawCommand 类型或样式（虚线边+半透明填充）。
    - 确保在不同 DPI 下表现一致。
  - 若交由 FE 的 UI 叠加层绘制，则本任务可标记为暂缓。

## QA 系（qa-automation-expert）

### TASK-1-QA-01 框选几何逻辑单元测试
- 职责：
  - 针对 GE 的框选命中算法编写单元测试：
    - 图元完全在框内 → 必须命中。
    - 图元与框有部分交集 → 根据规范判断命中/不命中。
    - 图元刚好接触框边界 → 覆盖边界条件。

### TASK-1-QA-02 框选交互端到端测试
- 职责：
  - 使用 Playwright/Cypress：
    - 模拟多方向拖拽形成框选矩形，验证被选中图元集合与预期一致。
    - 验证按下 Shift 进行追加选择/取消选择时行为是否符合规范。
    - 验证短距离点击不会误触发框选。

