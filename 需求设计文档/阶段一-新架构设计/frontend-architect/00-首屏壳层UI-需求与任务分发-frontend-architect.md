# 00-首屏壳层 UI —— 需求与任务分发（指派：frontend-architect）

> 适用范围：基于 Canvas 的 PCB 2D 编辑器首屏壳层（Top Bar / 用户区 / 全局搜索等），不包含画布区域和内部工具栏。

## 1. 背景与目标

- 本文件基于 `分析原料/index.html` 中提取的 DOM 与样式结构，参考嘉立创 EDA Pro 的首屏壳层布局。
- 目标是在现有 EDA 阶段一架构上，实现一套 **数据驱动、可扩展、可皮肤化** 的壳层 UI，用于承载：
  - 顶部导航与主菜单；
  - 用户登录与工作空间切换；
  - 多语言切换与版本信息；
  - 全局搜索入口；
  - Electron/桌面模式下的窗口控制按钮。
- 首屏壳层 UI 必须符合以下原则：
  - 与 `01-UI框架与交互系统-详细设计.md` 中的 Data-Driven UI 架构保持一致；
  - 所有可点击元素最终映射为数据驱动的菜单项或命令（Command），避免硬编码业务逻辑在 UI 层；
  - 对齐暗色主题（data-theme="dark"）下的整体视觉风格，颜色统一来自主题 Token。

## 2. 总体布局与模块划分

首屏壳层的布局结构可以抽象为三部分：

1. **顶层容器（AppShell / TopBarLayout）**
   - 顶部 32px 高的横向条，宽度占满窗口宽度。
   - 左侧：产品 Logo + 顶部菜单组。
   - 中间：客户端拖拽区域（Electron 模式）、版本信息。
   - 右侧：全局搜索、用户工具区（通知、上传、Workspace、语言、账户区等）。

2. **通用 UI 基础组件**
   - 菜单按钮 + 下拉菜单组件；
   - 通用下拉选择（Select / Dropdown）；
   - Icon 字体与 Theme Token 体系。

3. **集成层**
   - 与内核命令系统（Command + HistoryManager）的集成；
   - 与国际化系统（i18n）、用户会话、Workspace 状态、搜索服务的集成；
   - 与 Electron/桌面包装器的集成（可选）。

前端架构师需要在此基础上，给出具体组件拆分、路由/状态管理方案，并落地到 React + TypeScript 代码结构中（例如 apps/editor-web + shared UI library）。

## 3. 功能模块需求拆分

### 3.1 顶栏壳层布局（Top Bar Shell）

**目标**：实现一个可复用的顶栏布局组件，负责壳层结构，不承载具体业务逻辑。

- 布局要求：
  - 高度固定为 32px；
  - 使用 Flex 布局，将内容分为左、中、右三个区域：
    - Left：Logo + 主菜单条；
    - Center：版本信息 + 拖拽区域（桌面端）；
    - Right：全局搜索 + 用户工具区（通知/Workspace/账户/语言等）。
  - 顶栏背景色使用 `--bg-color-top-bar`；文字颜色使用 `--font-color-top-bar`。

- 集成要求：
  - 该组件作为应用的外层壳，与中间的 Canvas 编辑区域通过布局系统解耦；
  - 支持暗色/浅色主题切换（通过 CSS Variables 或 ThemeProvider）；
  - 通过配置（LayoutConfig）控制是否显示某些模块（例如是否启用全局搜索、是否显示窗口控制按钮）。

- 验收标准：
  - 在桌面宽度下，三个区域布局正确且不会互相遮挡；
  - 在窗口宽度缩小时，版本信息优先隐藏，其余模块可通过「更多」入口折叠；
  - 顶栏在主题切换时颜色与 hover/active 风格保持一致。

### 3.2 Logo 区与主菜单条（Logo + Menu Bar）

**目标**：实现 Logo 区与数据驱动的主菜单按钮行，参考类名 `.toolbar-common_51-3M`、`.eda-menu-btn-top_*`。

- Logo 区：
  - 左上角显示产品 Logo（SVG/Image），高度与顶栏对齐；
  - 点击 Logo 时：默认行为为「回到工程列表」或「回到首页」，行为由配置项控制；
  - Logo 链接应支持 A/B 环境（Dev/Staging/Prod）下可配置。

- 主菜单条：
  - 使用强类型 Schema 描述菜单结构，例如：
    - `File` / `Edit` / `View` / `Tools` / `Help` 等顶级菜单；
  - 每个菜单项支持：
    - 文本；
    - 可选的热键展示（如 `Ctrl+S`），使用 `data-hotkey` 属性或等价机制；
    - 状态：normal / hover / active（展开状态）；
  - 菜单超出宽度时，自动折叠进「更多」菜单（`...` 按钮），折叠策略可简单按顺序（从右向左）。

- 集成要求：
  - 菜单点击事件不直接操作内核，而是通过 Command 或统一的 Action Dispatcher 触发：
    - 如：File > New → 触发 `CMD_NEW_PROJECT`；
    - Edit > Undo → 触发 `CMD_UNDO`（最终连接到 HistoryManager）。
  - 菜单 Schema 存放在配置层，可被产品架构师调整而无需改动组件代码。

- 验收标准：
  - 顶级菜单在不同语言下长度变化时布局不崩；
  - 活动菜单高亮状态与下拉菜单联动；
  - 菜单点击可以通过日志或 DevTools 看到标准化命令被发出。

### 3.3 通用下拉菜单组件（DropdownMenu）

**目标**：实现一个通用的下拉菜单组件，服务于主菜单、右键菜单、用户菜单等多处场景。

- 视觉结构：
  - 菜单容器：背景色 `--bg-color-drop-down-menu`、边框 `--border-color-drop-down-menu`、投影 `--has-shadow-drop-down-menu`；
  - 菜单项：
    - 图标区域（左侧 16x16）；
    - 文本区域（标题）与右侧热键区域；
    - 可选子菜单箭头（右侧小三角）。

- 状态：
  - normal：字体使用 `--font-color-drop-down-menuItem`；
  - hover：背景 `--bg-color-hover-drop-down-menuItem`，字体变更为 `--font-color-hover-drop-down-menuItem`；
  - disabled：字体 `--font-color-disabled-drop-down-menuItem`，图标灰度；
  - active：用于表示当前选中/高亮项，可与子菜单展开关联。

- 行为：
  - 支持键盘导航（上下移动、Enter 选择），后续可扩展；
  - 支持点击外部区域关闭；
  - 支持多级菜单（子菜单以右侧箭头+次级浮层形式出现）。

- 集成要求：
  - 菜单项同样使用数据驱动 Schema，包含：id、label、icon、hotkey、disabled、children、command 等字段；
  - 下拉菜单组件不感知具体业务命令，仅将点击事件回调给上层。

- 验收标准：
  - 能被主菜单、Workspace 菜单、用户菜单等多个场景复用；
  - 使用统一的 Theme Token，切换主题后风格自动适配；
  - 在高 DPI 与缩放场景下显示清晰、无错位。

### 3.4 用户工具区（通知 / 上传 / Workspace）

**目标**：实现顶栏右侧的用户工具集合组件，包含通知、上传入口、Workspace 选择。

- 通知图标（Bell）：
  - 展示白色铃铛图标；
  - 当有未读消息时显示红点（圆形 8x8），数字可选；
  - 点击后可触发通知面板或简单的消息统计弹窗（可阶段性简化）。

- 上传工具入口：
  - 图标 + 文本按钮，用于触发「导入工程/封装库/文件」等操作；
  - 暂时可绑定到一个统一的 Command（如 `CMD_OPEN_IMPORT_DIALOG`）。

- Workspace 选择：
  - 显示当前 Workspace 名称；
  - 点击展开 Workspace 列表，使用通用 DropdownMenu 或轻量列表组件；
  - 选中 Workspace 后，触发外部回调更新全局状态，并关闭菜单。

- 集成要求：
  - Workspace 列表数据位于全局状态或配置服务，支持后端拉取；
  - 通知图标与后端消息服务解耦，通过接口返回未读计数或布尔值。

- 验收标准：
  - 用户工具区在不同分辨率下布局稳定；
  - Workspace 切换交互流畅，无严重闪烁；
  - 未登录态时，Workspace 区域可以默认隐藏或显示占位文本。

### 3.5 账号区域与用户菜单（Account / User Menu）

**目标**：实现登录/注册按钮（未登录态）与头像+用户菜单（已登录态）的 UI。

- 未登录态：
  - 显示「注册」按钮（橙色背景、圆角）与「登录」按钮；
  - 点击后触发对应对话框或跳转链接（由产品配置）。

- 已登录态：
  - 头像框：圆形头像图片 + 用户名文本（超出部分省略号显示）；
  - 小三角标记指示可展开用户菜单；
  - 用户菜单浮层：顶部为用户信息块（头像 + 用户名），下方为菜单项列表（如 Profile / Settings / Logout 等）。

- 集成要求：
  - 用户信息来自会话管理模块（如 `authStore`），前端架构需定义统一接口；
  - 菜单项同样通过菜单 Schema 配置，可添加/隐藏某些入口；
  - Logout 行为最终调用统一的登出流程，而非散落在组件内。

- 验收标准：
  - 登录/登出状态切换时 UI 实时更新，不卡顿；
  - 用户菜单在语言切换后文案实时更新；
  - 在不同用户名长度下布局不破坏顶栏高度和对齐。

### 3.6 语言切换入口（Language Switcher）

**目标**：提供语言选择入口，作为国际化系统的 UI 层入口。

- UI 要求：
  - 显示当前语言的简写文本（如 EN / 中）和小图标（国旗或语言标识）；
  - 点击后弹出语言列表浮层，每行包含图标 + 语言名称文字；
  - 支持至少两种语言（简体中文、英文），未来可扩展更多。

- 集成要求：
  - 切换语言时调用统一的 i18n 切换 API；
  - 将选择结果存储在本地缓存（localStorage 等），并在应用初始化时读取；
  - 与 `data-theme="dark"` 下的文本颜色和背景保持一致。

- 验收标准：
  - 切换语言后，顶栏所有菜单和文本在不刷新页面的情况下更新；
  - 首屏加载时语言状态与上次选择保持一致；
  - 语言列表在窄屏下仍可正确定位，不超出视口。

### 3.7 版本信息（Version Info）

**目标**：在顶栏展示当前应用版本与工程信息，便于调试和用户识别。

- UI 要求：
  - 文本格式建议为：`PCB Editor vX.Y.Z · 当前工程名`；
  - 文本溢出时使用省略号显示；
  - 在宽度较小（如 < 762px）时自动隐藏。

- 集成要求：
  - 版本号由构建系统注入（例如通过环境变量或静态配置）；
  - 当前工程名从全局状态中读取；
  - 在不同环境（Dev/Staging/Prod）可通过颜色或前缀标记环境信息（可选）。

- 验收标准：
  - 在开发与生产环境下显示的版本信息正确无误；
  - 工程名变更时文本自动更新；
  - 窄屏时版本信息不影响其他控件布局。

### 3.8 全局搜索入口（Global Search）

**目标**：提供一个顶栏的全局搜索入口，支持搜索元件/工程/帮助等内容（阶段一可只实现 UI 与基础交互）。

- UI 要求：
  - 默认显示放大镜图标按钮（矩形 24px 高，宽 32px），靠近用户区；
  - 点击图标后展开搜索输入条：
    - 文本输入框（输入关键字）；
    - 下拉选择（搜索范围：如「元件库」「工程」「文档」等）；
  - 再次点击图标或点击外部区域时收起搜索输入条。

- 集成要求：
  - 搜索输入变更时，不直接调用后端，而是通过 debounce 触发搜索请求；
  - 搜索范围与关键字通过统一接口（如 `searchService.search(scope, keyword)`）调用；
  - 搜索入口将来可复用到其他页面（不仅限于 PCB 编辑器）。

- 验收标准：
  - 展开/收起动画流畅，无明显抖动；
  - 输入内容时输入框不会盖住其他顶部控件；
  - 即使暂时未接后端，也能通过模拟数据演示搜索结果面板。

### 3.9 头像组 / 多账户入口（可选）

**目标**：预留多账户或状态指示入口，使用圆形头像 + 状态点 + 更多按钮的组合。

- UI 要求：
  - 圆形头像图标（24x24），边框颜色来自 `--common-border-color`；
  - 头像右下角状态小圆点（8x8），用于表示在线状态（颜色可配置）；
  - 附加一个圆形按钮（more-container），显示 `+` 或数字，点击弹出账户列表。

- 集成要求：
  - 组件本身与账号体系解耦，可以作为纯 UI 组件复用；
  - 实现统一的位置与样式，后续接入多账户时直接提供数据源即可。

- 验收标准：
  - 头像与状态点在不同 DPI 下依旧圆滑、边框清晰；
  - more 容器点击区域合理，不影响周围控件点击。

### 3.10 窗口控制条（Electron / 桌面模式）

**目标**：当应用运行在 Electron 或桌面壳中时，使用自定义窗口控制按钮替代系统原生控制条。

- UI 要求：
  - 一组按钮：最小化、最大化/还原、关闭、设置；
  - 图标使用统一的 icon 字体；
  - hover 状态背景半透明白，关闭按钮 hover 时背景为红色。

- 行为：
  - 在 Web 模式下可以隐藏整个控制条或仅保留设置按钮；
  - 在桌面模式下，点击按钮调用对应的窗口控制 API。

- 集成要求：
  - 前端架构需要定义环境检测逻辑（如检测 Electron），并根据环境渲染或隐藏控制条；
  - 控制条与顶部拖拽区域（`app-region: drag`）配合使用，确保可拖动窗口。

- 验收标准：
  - 桌面模式下窗口控制行为正确；
  - Web 模式下不会显示多余按钮。

### 3.11 通用下拉选择 / Select 组件

**目标**：实现一个通用 Select 组件，用于全局搜索范围、Workspace 列表、语言列表等场景。

- UI 要求：
  - 触发容器：
    - 显示当前选中的文本，溢出时省略号；
    - 右侧下拉箭头图标（可使用 icon 字体或 SVG）；
  - 选项浮层：
    - 边框、背景与菜单风格保持一致；
    - 支持滚动列表；
    - 可选过滤输入框。

- 行为：
  - 点击触发容器展开/收起选项浮层；
  - 点击选项后更新当前值，并触发 `onChange` 回调；
  - 点击外部区域收起浮层。

- 集成要求：
  - 由前端架构负责定义统一的 Select 属性接口（options/value/onChange/disabled 等）；
  - 内部可调优性能（如虚拟列表）但对外接口保持简单。

- 验收标准：
  - 在所有使用 Select 的场景中，视觉和交互行为统一；
  - 支持键盘导航（上下选择 + Enter）可作为加分项。

## 4. 技术与架构约束

- 技术栈：
  - 前端：React + TypeScript；
  - 状态管理：与既有方案（如 Zustand/Redux）保持一致；
  - 样式：优先使用 CSS Variables + 模块化样式方案，方便主题切换与按需加载。

- 数据驱动与配置化：
  - 菜单/下拉项/Workspace/语言选项等均通过配置驱动；
  - 配置结构需有清晰的 TS 类型定义，方便产品/其他开发调整。

- 集成其他模块：
  - 与历史记录系统（Undo/Redo）、属性系统、文件系统等模块通过 Command 或 EventBus 通信；
  - 与国际化模块通过统一 i18n 服务接口集成；
  - 与用户会话模块通过统一 Auth Store 接入。

## 5. 任务分发（frontend-architect）

负责人：**前端架构（frontend-architect）**

阶段一需要完成的核心任务：

1. 设计首屏壳层 UI 的组件树与目录结构，将本文件中功能模块抽象为一组可复用组件（TopBarLayout/MenuBar/DropdownMenu/UserBar/SearchBar/LanguageSwitcher 等）。
2. 基于现有 `01-UI框架与交互系统-详细设计.md` 中的 Data-Driven UI 思想，设计菜单与下拉组件的 Schema 类型定义，并在工程中落地（types + 配置文件）。
3. 实现首屏壳层 UI 的 React 组件与样式，确保在暗色主题下显示正确，并支持未来的主题扩展。
4. 将首屏壳层 UI 与应用的状态管理、命令分发、国际化系统、用户会话模块进行最小可用的集成（可以部分使用 mock 数据）。
5. 为后续的 QA 自动化测试预留稳定的 DOM 结构与测试钩子（data-testid / role 等），确保交互行为易于测试。

交付物：

- 一套在编辑器首屏即可使用的顶栏壳层 UI；
- 菜单/语言/Workspace/账号等 UI 的 Schema 类型定义与示例配置；
- 与核心业务模块的初步集成代码（或清晰的接口约定）。

