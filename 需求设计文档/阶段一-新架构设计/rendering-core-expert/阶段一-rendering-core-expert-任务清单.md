# 阶段一 - 渲染引擎专家（rendering-core-expert）任务清单

> 目标：聚焦 PCB 视图渲染、性能与未来多后端扩展，把相关实现任务集中管理。

## 0. 关联设计文档

- [00-架构总览与模块划分](../00-架构总览与模块划分.md)
- [03-图形内核与算法-详细设计](../03-图形内核与算法-详细设计.md)
- [04-基础设施与数据结构-详细设计](../04-基础设施与数据结构-详细设计.md)
- [07-图形内核-几何算法库-详细设计](../07-图形内核-几何算法库-详细设计.md)
- [EDA-阶段一-需求与任务分发](../EDA-阶段一-需求与任务分发.md)
- [RenderingCoreExpert-疑问与假设](../RenderingCoreExpert-疑问与假设.md)

---

## 1. IRenderer2D 与 DrawCommand 设计

1. 与 graphics-engineer 协作，确定渲染接口：
   - IRenderer2D 暴露的基本图元（线段、多边形、文本等）；
   - DrawCommand 结构（类型、坐标、样式等）。
2. 在当前 Canvas2D 后端上实现 IRenderer2D：
   - 支持多层叠加与透明度设置；
   - 支持高 DPI 渲染。

## 2. PCB 视图渲染风格

1. 根据 product-architect 的视图风格指南，实现：
   - 板框与机械层轮廓渲染；
   - Footprint 轮廓与 Pad/Track/Via 的 PCB 风格绘制；
   - 选中/悬停高亮（包括颜色与线宽调整）。
2. 实现层可见性控制：
   - 根据 Layer 的 visible/locked 属性过滤渲染；
   - 为当前编辑层增加视觉强调。

## 3. 性能与增量渲染

1. 设计并实现基础的渲染缓存策略：
   - 将静态内容（板框、固定标注等）与动态内容分层；
   - 在实体变更时按区域进行脏矩形重绘。
2. 评估中等规模 PCB（数百 Footprint、数千 Track）下的渲染成本：
   - 给出 FPS 基线与瓶颈分析；
   - 为后续 WebGL/WebGPU 预留优化点和接口。

## 4. 视口与 DPI 处理

1. 与 graphics-engineer 对齐视口矩阵使用方式：
   - 在渲染层正确应用缩放/平移；
   - 保证线宽与 Pad 尺寸在视口变化下视觉合理。
2. 处理高 DPI：
   - 基于设备像素比调整 Canvas 尺寸与缩放；
   - 校验文本与细线在高 DPI 下的可读性。

## 5. 几何输出与三角剖分对接

1. 与几何库对接：
   - 约定用于渲染的数据结构（多边形顶点列表、三角形索引等）；
   - 使用 earcut 等算法对带洞多边形进行三角剖分（为后续 WebGL 做准备）。
2. 在当前阶段可只在内部使用三角形列表做可视化调试，不强制接入 WebGL。

## 6. 调试与可视化工具

1. 提供基础渲染调试面板：
   - 显示当前渲染开关（抗锯齿、叠加层、选中高亮等）；
   - 显示当前 FPS 或粗略性能指标。
2. 与 qa-automation-expert 协作：
   - 暴露用于截图/渲染比对的稳定接口；
   - 定义渲染回归测试所需的输入与检验方式。

