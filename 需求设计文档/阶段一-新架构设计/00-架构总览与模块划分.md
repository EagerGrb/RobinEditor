# EDA 阶段一：新架构总览与模块划分（PCB）

## 1. 架构目标
基于现有的图形基础设施（Stage 1 Part 3 产出），构建面向 PCB 2D 编辑器的、数据驱动的、高度解耦的应用层架构。
核心原则：**UI 数据驱动**、**内核与渲染分离**、**功能模块化**，并且在业务上围绕 PcbDocument、Board、LayerStack、Footprint、Track、Via 等实体展开。

## 2. 模块划分与职责分配

### 2.1 UI 与交互层（frontend-architect & product-architect）
| 模块名称 | 职责描述 | 负责人 |
| :--- | :--- | :--- |
| **UI Framework** | PCB 编辑器整体布局（画布、层面板、Footprint 列表、属性面板），基于数据驱动生成界面。 | frontend-architect |
| **Property Panel** | 针对 Footprint/Pad/Track/Via/BoardOutline 等实体的属性展示、编辑、编码与解码。 | frontend-architect |
| **Dialog System** | 内核与 UI 交互的中间层，处理网格设置、层堆栈编辑等弹窗。 | frontend-architect |
| **Shortcut Manager** | PCB 工具和视图操作的快捷键配置、存储与冲突管理，分发命令到内核。 | frontend-architect / graphics-engineer |

### 2.2 核心数据与业务逻辑层（graphics-engineer）
| 模块名称 | 职责描述 | 负责人 |
| :--- | :--- | :--- |
| **Design Rule** | PCB 设计规则（线宽/间距/层规则等）的定义、存储、校验与错误报告生成。 | graphics-engineer / product-architect |
| **History System** | 针对 PCB 操作（放置 Footprint、走线、放 Via、修改属性等）的撤销/重做栈管理，支持命令模式与状态快照。 | graphics-engineer |
| **File Format** | PCB 文档在 `.rbeditor` 中的编码与解码规范（PcbDocument/Board/LayerStack/Entities）。 | graphics-engineer |
| **Import/Export** | PCB 相关数据的导入导出转换器（如简化网表/JSON/调试用文本格式）。 | graphics-engineer |
| **Core Cache** | 空间索引、命中缓存、渲染命令缓存等核心结构缓存，加速大规模 PCB 的查询与渲染。 | graphics-engineer |

### 2.3 图形内核与渲染层（graphics-engineer & rendering-core-expert）
| 模块名称 | 职责描述 | 负责人 |
| :--- | :--- | :--- |
| **Basic Primitives** | 基础图元（线段/圆弧/多段线/多边形等）的数学表达与几何逻辑，服务于 PCB 实体几何。 | graphics-engineer |
| **Model-View Layer** | 将 Footprint/Pad/Track/Via/BoardOutline 等业务实体转换为基础图元并同步到渲染引擎。 | graphics-engineer / rendering-core-expert |
| **Algorithm** | 几何算法库（相交检测、距离计算、多边形布尔、三角剖分等），支撑 DRC 与命中/吸附。 | graphics-engineer |
| **Rendering Engine** | 针对多层 PCB 的渲染后端，实现 IRenderer2D 抽象，不含业务逻辑。 | rendering-core-expert |

## 3. 详细设计索引
*   [01-UI框架与交互系统-详细设计.md](./01-UI框架与交互系统-详细设计.md)
*   [02-核心数据与文件系统-详细设计.md](./02-核心数据与文件系统-详细设计.md)
*   [03-图形内核与算法-详细设计.md](./03-图形内核与算法-详细设计.md)

## 4. 角色与责任分工（智能体）

- 产品架构师（product-architect）
  - 从 PCB 产品视角补充和约束 Design Rule 模块的业务规则；
  - 定义 PcbDocument/Board/LayerStack/Net 等实体在各模块中的业务边界。
- 前端架构（frontend-architect）
  - 负责 UI Framework、Property Panel、Dialog System、Shortcut Manager 等模块在前端的整体设计与实现；
  - 落实与图形内核之间的数据流和事件流，保证交互与视觉一致性。
- 图形开发专家（graphics-engineer）
  - 负责核心数据与业务逻辑层的全部模块，以及 Basic Primitives、Model-View Layer、Algorithm 等图形内核模块；
  - 负责 `.rbeditor` PCB 结构设计、Core Cache 与空间索引等性能关键路径。
- 渲染引擎专家（rendering-core-expert）
  - 负责 Rendering Engine 的实现与扩展，为多层 PCB 提供高性能渲染后端；
  - 与 graphics-engineer 协同确定渲染接口与绘制风格。
- 测试专家（qa-automation-expert）
  - 基于本文件的模块划分，设计端到端与模块级自动化测试用例；
  - 特别关注历史记录、文件编解码、空间索引与渲染表现的一致性和回归风险。
