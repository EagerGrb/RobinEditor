# 阶段一：Canvas 2D PRD

## 目标

- 实现 Web 端高精度 2D 户型编辑器
- 达到工程图可用程度，具备清晰的构件层级
- 为阶段二 3D 挤出提供稳定、完整的数据

## 核心功能范围

- 墙体绘制：直线段墙，支持连续绘制与闭合
- 门窗放置：拖拽放置到墙体并自动对齐
- 尺寸测量：自动尺寸与手动标注
- 网格与吸附：网格显示、对齐吸附、端点吸附
- 视图控制：平移、缩放、适配视口
- 选择与编辑：单选、多选、删除、拖拽移动

## 非目标

- 3D 预览与材质系统
- 多层结构与楼层管理
- 多用户协作与权限

## 用户故事与验收标准

### 绘制墙体

- 用户可从任意起点连续绘制墙体并闭合
- 结束绘制后墙体形成合法拓扑，无自交
- 绘制过程中显示动态长度与角度提示

### 门窗放置

- 门窗拖到墙体时自动贴合墙中心线
- 门窗放置后可在墙上滑动调整位置
- 门窗不能越过墙端点或穿越墙体断点

### 尺寸测量

- 自动标注墙段长度并可切换显示/隐藏
- 手动标注可选择两点生成尺寸线
- 尺寸标注随缩放保持清晰可读

### 吸附系统

- 吸附网格间距可配置且可开关
- 鼠标接近端点或墙线时出现吸附提示
- 吸附误差不超过配置阈值

### 视图操作

- 鼠标滚轮缩放，保持指针位置为中心
- 空格键或中键拖拽实现平移
- 适配视口可一键将图形居中

## 核心数据模型

- Scene
  - rooms: Room[]
  - walls: Wall[]
  - openings: Opening[]
  - dimensions: Dimension[]
  - grid: Grid

- Wall
  - id
  - start: Point
  - end: Point
  - thickness
  - height
  - roomIds

- Opening
  - id
  - type: door | window
  - wallId
  - position: number
  - width
  - height

## 关键交互流程

- 绘制流程：进入绘制模式 -> 连续点击 -> 双击结束
- 编辑流程：选择构件 -> 显示控制柄 -> 拖拽调整
- 复制流程：选中 -> 复制 -> 贴合吸附

## 关键技术挑战与方案

- 场景图层级
  - 采用扁平数据 + 引用关系，避免深层嵌套更新困难

- 坐标体系
  - 使用世界坐标存储，视图坐标仅在渲染阶段转换

- 选中判定
  - 点到线段距离阈值与缩放级别联动

- 渲染清晰度
  - 线宽与字体大小随缩放保持可读

## 成功指标

- 95% 基础绘制流程在 5 分钟内完成
- 交互错误率低于 5%
- 连续绘制 200 墙体仍保持流畅

## 依赖与风险

- 操作精度与可用性之间的权衡
- 门窗放置逻辑与墙体拓扑一致性
